generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Product {
  id                String   @id @default(uuid())
  name              String
  bank              String
  type              String   // 'personal','education','vehicle','home','credit_line','debt_consolidation'
  rate_apr          Decimal  @db.Decimal(5, 2)
  min_income        Decimal  @db.Decimal(12, 2)
  min_credit_score  Int
  tenure_min_months Int      @default(6)
  tenure_max_months Int      @default(60)
  processing_fee_pct Decimal @default(0) @db.Decimal(5, 2)
  prepayment_allowed Boolean @default(true)
  disbursal_speed   String   @default("standard")
  docs_level        String   @default("standard")
  summary           String?
  faq               Json?    @default("[]")
  terms             Json?    @default("{}")
  chat_sessions     AiChatMessage[]

  @@map("products")
}

model User {
  id              String   @id @default(uuid())
  email           String   @unique
  display_name    String?
  monthly_income  Decimal? @db.Decimal(12, 2)
  credit_score    Int?
  employment_type String?  // "salaried", "business"
  chat_sessions     AiChatMessage[]

  @@map("users")
}

model AiChatMessage {
  id          String   @id @default(uuid())
  user_id     String
  product_id  String
  messages    Json     // Stores array of {role, content, timestamp}
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @updatedAt @db.Timestamptz(6)
  
  user        User     @relation(fields: [user_id], references: [id])
  product     Product  @relation(fields: [product_id], references: [id])

  @@unique([user_id, product_id])
  @@map("ai_chat_messages")
}

